<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wishtree | Intelligent PO & Visibility Hub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- App Logic -->
    <script src="js/app.js"></script>

    <style>
        .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }

        .status-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: .5;
            }
        }

        [x-cloak] {
            display: none !important;
        }

        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.5s;
        }

        .fade-enter,
        .fade-leave-to {
            opacity: 0;
        }
    </style>
</head>

<body class="bg-slate-50 font-sans text-slate-900" x-data="app">

    <!-- Modal for Mailbox Sync -->
    <div x-show="showMailboxModal" x-transition.opacity
        class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm" x-cloak>
        <div class="bg-white p-8 rounded-2xl shadow-2xl flex flex-col items-center space-y-4 max-w-sm w-full">
            <div class="relative">
                <div class="w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <i data-lucide="mail" class="w-6 h-6 text-blue-600"></i>
                </div>
            </div>
            <h3 class="text-lg font-bold text-slate-800" x-text="syncMessage"></h3>
            <p class="text-sm text-slate-500 text-center">Simulating background extraction...</p>
        </div>
    </div>

    <!-- Modal for Sales Comparison (Process Evolution) -->
    <div x-show="showComparisonModal" x-transition.opacity
        class="fixed inset-0 bg-slate-900/80 z-[60] flex items-center justify-center backdrop-blur-sm" x-cloak>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col max-h-[90vh]"
            @click.outside="showComparisonModal = false">
            <div class="px-8 py-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Process Evolution</h2>
                    <p class="text-slate-500">ROI Analysis & Workflow Comparison</p>
                </div>
                <button @click="showComparisonModal = false"
                    class="text-slate-400 hover:text-slate-600 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-0">
                <div class="grid grid-cols-1 md:grid-cols-2 h-full">
                    <!-- Legacy / Left -->
                    <div class="p-8 bg-slate-50 border-r border-slate-200">
                        <div class="flex items-center space-x-3 mb-8">
                            <span class="bg-slate-200 p-2 rounded-lg"><i data-lucide="history"
                                    class="w-5 h-5 text-slate-600"></i></span>
                            <h3 class="text-lg font-bold text-slate-600">The Adobe Bottleneck</h3>
                        </div>

                        <div class="space-y-6 relative">
                            <!-- Vertical Line -->
                            <div class="absolute left-4 top-4 bottom-4 w-0.5 bg-slate-200"></div>

                            <!-- Steps -->
                            <div class="relative pl-12">
                                <span
                                    class="absolute left-0 top-0 w-8 h-8 rounded-full bg-slate-200 border-4 border-white flex items-center justify-center text-xs font-bold text-slate-500">1</span>
                                <h4 class="font-bold text-slate-700">Manual Email Check</h4>
                                <p class="text-xs text-slate-500 mt-1">Staff constantly refreshing inbox.</p>
                            </div>
                            <div class="relative pl-12 opacity-75">
                                <span
                                    class="absolute left-0 top-0 w-8 h-8 rounded-full bg-slate-200 border-4 border-white flex items-center justify-center text-xs font-bold text-slate-500">2</span>
                                <h4 class="font-bold text-slate-700">Download Attachments</h4>
                                <p class="text-xs text-slate-500 mt-1">Files saved to local desktop folders.</p>
                            </div>
                            <div class="relative pl-12 opacity-75">
                                <span
                                    class="absolute left-0 top-0 w-8 h-8 rounded-full bg-slate-200 border-4 border-white flex items-center justify-center text-xs font-bold text-slate-500">3</span>
                                <h4 class="font-bold text-slate-700">Open in Adobe Acrobat</h4>
                                <p class="text-xs text-slate-500 mt-1">Struggles with image-based text recognition.</p>
                            </div>
                            <div class="relative pl-12 opacity-75">
                                <span
                                    class="absolute left-0 top-0 w-8 h-8 rounded-full bg-slate-200 border-4 border-white flex items-center justify-center text-xs font-bold text-slate-500">4</span>
                                <h4 class="font-bold text-slate-700">Copy-Paste to Excel</h4>
                                <p class="text-xs text-slate-500 mt-1">High risk of human error in transcription.</p>
                            </div>
                            <div class="relative pl-12 opacity-50">
                                <span
                                    class="absolute left-0 top-0 w-8 h-8 rounded-full bg-slate-200 border-4 border-white flex items-center justify-center text-xs font-bold text-slate-500">5</span>
                                <h4 class="font-bold text-slate-700">Manual Cleanup</h4>
                                <p class="text-xs text-slate-500 mt-1">Formatting issues require hours of fixes.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Wishtree / Right -->
                    <div class="p-8 bg-white relative overflow-hidden">
                        <div
                            class="absolute top-0 right-0 w-64 h-64 bg-blue-50 rounded-full blur-3xl -mr-32 -mt-32 opacity-50 pointer-events-none">
                        </div>

                        <div class="flex items-center space-x-3 mb-8 relative z-10">
                            <span class="bg-blue-100 p-2 rounded-lg"><i data-lucide="zap"
                                    class="w-5 h-5 text-blue-600"></i></span>
                            <h3 class="text-lg font-bold text-slate-800">The Wishtree Flow</h3>
                        </div>

                        <div class="space-y-8 relative z-10">
                            <!-- Vertical Line -->
                            <div class="absolute left-4 top-4 bottom-4 w-0.5 bg-blue-100"></div>

                            <!-- Steps -->
                            <div class="relative pl-12">
                                <span
                                    class="absolute left-0 top-0 w-8 h-8 rounded-full bg-blue-600 border-4 border-white flex items-center justify-center shadow-lg shadow-blue-200">
                                    <i data-lucide="mail" class="w-3.5 h-3.5 text-white"></i>
                                </span>
                                <h4 class="font-bold text-slate-800 text-lg">Automated Mailbox Ingestion</h4>
                                <p class="text-sm text-slate-500 mt-1">"Zero-Touch" background processing.</p>
                            </div>

                            <div class="relative pl-12">
                                <span
                                    class="absolute left-0 top-0 w-8 h-8 rounded-full bg-green-500 border-4 border-white flex items-center justify-center shadow-lg shadow-green-200">
                                    <i data-lucide="check" class="w-3.5 h-3.5 text-white"></i>
                                </span>
                                <h4 class="font-bold text-slate-800 text-lg">AI-Verified SAP Ready Data</h4>
                                <p class="text-sm text-slate-500 mt-1">Confidence scores & discrepancy alerts built-in.
                                </p>
                            </div>

                            <!-- Connector Highlight -->
                            <div class="relative pl-12 mt-12 bg-blue-50/50 p-4 rounded-xl border border-blue-100">
                                <div class="absolute -left-6 top-1/2 -translate-y-1/2 w-8 h-0.5 bg-blue-200"></div>
                                <span
                                    class="absolute left-0 top-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-blue-400 border-2 border-white"></span>

                                <h4 class="font-bold text-blue-700 flex items-center gap-2">
                                    <i data-lucide="truck" class="w-4 h-4"></i> Integrated Carrier Tracking
                                </h4>
                                <p class="text-xs text-blue-600 mt-1">Real-time visibility loop (The "Missing Link"
                                    solved).</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-slate-100 bg-slate-50 flex justify-end">
                <button @click="showComparisonModal = false"
                    class="bg-slate-900 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-800 transition-colors">Close
                    Comparison</button>
            </div>
        </div>
    </div>

    <!-- Confetti / Success Overlay -->
    <div x-show="sapExportSuccess" x-transition
        class="fixed inset-0 z-[100] flex items-center justify-center pointer-events-none" x-cloak>
        <div class="bg-green-600 text-white px-8 py-6 rounded-2xl shadow-2xl flex flex-col items-center animate-bounce">
            <i data-lucide="check-circle" class="w-16 h-16 mb-4 text-white"></i>
            <h3 class="text-2xl font-bold">Success!</h3>
            <p class="text-green-100">XLSX Generated & Emailed to SAP Integration Team.</p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div x-show="escalateToast.show" x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 translate-y-2"
        class="fixed bottom-8 right-8 z-[100] bg-slate-900 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-4 border border-slate-700"
        x-cloak>
        <div class="bg-amber-500 p-2 rounded-lg text-slate-900">
            <i data-lucide="mail" class="w-5 h-5"></i>
        </div>
        <div>
            <h4 class="font-bold">Escalation Triggered</h4>
            <p class="text-xs text-slate-400" x-text="escalateToast.message"></p>
        </div>
    </div>

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside
            class="w-64 bg-white border-r border-slate-200 text-slate-800 flex flex-col flex-shrink-0 transition-all duration-300">
            <!-- Logo Section -->
            <div class="h-20 flex items-center px-6 border-b border-slate-100">
                <img src="https://wishtreetech.com/wp-content/uploads/2023/10/wishtree-blue-logo.svg"
                    alt="Wishtree Technologies" class="h-10 w-auto object-contain">
            </div>

            <nav class="flex-1 p-4 space-y-2">
                <a href="#" @click.prevent="currentView = 'dashboard'"
                    :class="currentView === 'dashboard' ? 'bg-blue-600 text-white shadow-md shadow-blue-200' : 'hover:bg-slate-50 text-slate-500'"
                    class="flex items-center space-x-3 p-3 rounded-lg transition-all font-medium">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i> <span>Dashboard</span>
                </a>
                <a href="#" @click.prevent="currentView = 'mailbox'"
                    :class="currentView === 'mailbox' ? 'bg-blue-600 text-white shadow-md shadow-blue-200' : 'hover:bg-slate-50 text-slate-500'"
                    class="flex items-center space-x-3 p-3 rounded-lg transition-all font-medium">
                    <i data-lucide="mail" class="w-5 h-5"></i> <span>Auto-Ingestion</span>
                </a>
                <a href="#" @click.prevent="currentView = 'shipping'"
                    :class="currentView === 'shipping' ? 'bg-blue-600 text-white shadow-md shadow-blue-200' : 'hover:bg-slate-50 text-slate-500'"
                    class="flex items-center space-x-3 p-3 rounded-lg transition-all font-medium">
                    <i data-lucide="truck" class="w-5 h-5"></i> <span>Shipping Hub</span>
                </a>
                <a href="#" @click.prevent="currentView = 'sap'"
                    :class="currentView === 'sap' ? 'bg-blue-600 text-white shadow-md shadow-blue-200' : 'hover:bg-slate-50 text-slate-500'"
                    class="flex items-center space-x-3 p-3 rounded-lg transition-all font-medium">
                    <i data-lucide="file-spreadsheet" class="w-5 h-5"></i> <span>SAP Exports</span>
                </a>
            </nav>
            <div class="p-4 border-t border-slate-100 bg-slate-50/50">
                <div class="flex items-center space-x-3 p-2">
                    <div
                        class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-xs font-bold ring-2 ring-white text-blue-700">
                        JH</div>
                    <div>
                        <p class="text-sm font-bold text-slate-700">John Doe</p>
                        <p class="text-xs text-slate-400">Logistics Lead</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden bg-slate-50 relative">

            <!-- Header -->
            <header class="h-16 bg-white border-b flex items-center justify-between px-8 flex-shrink-0 z-10">
                <h2 class="text-lg font-semibold flex items-center space-x-2 text-slate-700">
                    <span class="text-slate-400">Operations /</span> <span
                        x-text="currentView.charAt(0).toUpperCase() + currentView.slice(1)"></span>
                </h2>
                <div class="flex items-center space-x-4">
                    <!-- Comparison Trigger -->
                    <button @click="showComparisonModal = true"
                        class="text-xs bg-slate-900 text-white px-3 py-1.5 rounded-md font-bold hover:bg-slate-700 transition-colors flex items-center gap-2 shadow-sm">
                        <i data-lucide="bar-chart-2" class="w-3 h-3"></i>
                        Wishtree vs. Legacy
                    </button>

                    <template x-if="currentView === 'shipping'">
                        <div
                            class="text-xs text-slate-500 flex items-center bg-slate-100 px-3 py-1 rounded-full border border-slate-200">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse mr-2"></span>
                            Live API Feed (Last update: <span x-text="lastUpdatedTime"></span>)
                        </div>
                    </template>
                    <div class="relative cursor-pointer hover:bg-slate-50 p-2 rounded-full transition-colors">
                        <i data-lucide="bell" class="w-6 h-6 text-slate-400"></i>
                        <span
                            class="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"></span>
                    </div>
                </div>
            </header>

            <!-- Scrollable Area -->
            <div class="flex-1 overflow-y-auto p-8 space-y-8 pb-20 relative">

                <!-- VIEW: DASHBOARD (Default Extraction Workspace) -->
                <div x-show="currentView === 'dashboard'" x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100">

                    <!-- Sales Component: Impact Tracker Widget -->
                    <div
                        class="absolute top-0 right-0 mt-8 mr-8 w-72 glass-panel border border-white/50 shadow-xl rounded-xl p-4 transform transition-all hover:scale-105 z-20">
                        <div class="flex items-center justify-between mb-3 border-b border-slate-100 pb-2">
                            <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider">Weekly Efficiency
                                Gains</h4>
                            <i data-lucide="zap" class="w-4 h-4 text-amber-500 fill-amber-100"></i>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <p class="text-[10px] text-slate-400 uppercase font-bold">Manual Hours Reclaimed</p>
                                <div class="flex items-baseline space-x-1">
                                    <span class="text-3xl font-bold text-slate-800" x-text="hoursReclaimed"></span>
                                    <span class="text-xs text-green-600 font-bold">+1.8 hrs/day</span>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <p class="text-[10px] text-slate-400 uppercase font-bold">Accuracy</p>
                                    <p class="text-lg font-bold text-slate-800">99.8%</p>
                                    <p class="text-[9px] text-slate-400">vs 82% Industry</p>
                                </div>
                                <div>
                                    <p class="text-[10px] text-slate-400 uppercase font-bold">Speed</p>
                                    <div class="flex items-center space-x-1">
                                        <p class="text-lg font-bold text-slate-800">2.4s</p>
                                        <span
                                            class="w-2 h-2 bg-green-500 rounded-full animate-pulse shadow-green-200 shadow-md"></span>
                                    </div>
                                    <p class="text-[9px] text-green-600 font-bold">Ultra-Fast</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- KPI Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 pr-80">
                        <!-- Added pr-80 to avoid overlap with widget -->
                        <div class="bg-white p-6 rounded-xl border border-slate-100 shadow-sm">
                            <div class="flex justify-between items-start">
                                <p class="text-slate-500 text-sm font-medium uppercase tracking-wider">Extracted Today
                                </p>
                                <div class="p-2 bg-green-50 rounded-lg"><i data-lucide="file-check"
                                        class="text-green-600 w-5 h-5"></i></div>
                            </div>
                            <h3 class="text-3xl font-bold mt-4 text-slate-800" x-text="mailboxCount"></h3>
                            <p class="text-xs text-green-600 mt-2 font-medium flex items-center"><i
                                    data-lucide="trending-up" class="w-3 h-3 mr-1"></i> 12% from yesterday</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-100 shadow-sm">
                            <div class="flex justify-between items-start">
                                <p class="text-slate-500 text-sm font-medium uppercase tracking-wider">Manual Review</p>
                                <div class="p-2 bg-amber-50 rounded-lg"><i data-lucide="alert-circle"
                                        class="text-amber-500 w-5 h-5"></i></div>
                            </div>
                            <h3 class="text-3xl font-bold mt-4 text-slate-800">4</h3>
                            <p class="text-xs text-slate-500 mt-2">Low-confidence fields detected</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-100 shadow-sm cursor-pointer hover:border-blue-300 transition-colors"
                            @click="currentView = 'shipping'">
                            <div class="flex justify-between items-start">
                                <p class="text-slate-500 text-sm font-medium uppercase tracking-wider">In-Transit Issues
                                </p>
                                <div class="p-2 bg-red-50 rounded-lg"><i data-lucide="truck"
                                        class="text-red-500 w-5 h-5"></i></div>
                            </div>
                            <h3 class="text-3xl font-bold mt-4 text-slate-800">2</h3>
                            <p class="text-xs text-red-600 mt-2 font-medium italic underline">View Delayed Shipments
                                &rarr;</p>
                        </div>
                    </div>

                    <!-- Extraction Workspace -->
                    <div class="bg-white rounded-xl border border-slate-200 shadow-lg overflow-hidden flex flex-col">
                        <div class="bg-slate-50 px-6 py-4 border-b flex justify-between items-center">
                            <div class="flex items-center space-x-3">
                                <div class="bg-blue-100 p-1.5 rounded-md"><i data-lucide="scan-line"
                                        class="w-5 h-5 text-blue-600"></i></div>
                                <div>
                                    <h3 class="font-bold text-slate-800">AI Extraction Workspace</h3>
                                    <p class="text-xs text-slate-500">Processing: <span class="font-mono text-slate-700"
                                            x-text="'PO #' + poData.number"></span></p>
                                </div>
                            </div>
                            <span
                                class="bg-green-100 text-green-700 text-xs font-bold px-3 py-1.5 rounded-full flex items-center shadow-sm"><i
                                    data-lucide="check-circle" class="w-3 h-3 mr-1.5"></i> MATCHED TO VENDOR</span>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2">
                            <!-- Left: PDF Viewer -->
                            <div
                                class="p-6 bg-slate-100 flex items-center justify-center border-r border-slate-200 relative overflow-hidden group">
                                <div
                                    class="absolute top-4 left-4 bg-slate-800/90 text-white text-[10px] uppercase font-bold px-3 py-1.5 rounded shadow z-10 backdrop-blur-sm">
                                    Image-Based PDF</div>
                                <div
                                    class="relative w-full max-w-sm bg-white shadow-2xl rounded-sm transition-transform duration-300 group-hover:scale-[1.02]">
                                    <img src="assets/images/dummy_po.png" alt="PO Preview"
                                        class="w-full h-auto object-cover opacity-90 hover:opacity-100 transition-opacity"
                                        onerror="this.src='https://placehold.co/600x800/white/black?text=PO+Document+Preview'" />
                                </div>
                            </div>
                            <!-- Right: Data Editor -->
                            <div class="p-6 flex flex-col h-full">
                                <div class="grid grid-cols-2 gap-6 mb-6">
                                    <div>
                                        <label
                                            class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">PO
                                            Number</label>
                                        <div
                                            class="flex items-center justify-between border-b border-slate-200 pb-1 group focus-within:border-blue-500 transition-colors">
                                            <input type="text" x-model="poData.number"
                                                class="w-full bg-transparent font-medium text-slate-800 focus:outline-none placeholder-slate-300">
                                            <span
                                                class="text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold"
                                                x-text="poData.poConfidence + '%'"></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label
                                            class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">Vendor</label>
                                        <div
                                            class="flex items-center justify-between border-b border-slate-200 pb-1 group focus-within:border-blue-500 transition-colors">
                                            <input type="text" x-model="poData.vendor"
                                                class="w-full bg-transparent font-medium text-slate-800 focus:outline-none placeholder-slate-300">
                                            <span
                                                class="text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold"
                                                x-text="poData.vendorConfidence + '%'"></span>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="bg-slate-50 rounded-lg p-1 border border-slate-200 mb-6 flex-1 overflow-auto">
                                    <table class="w-full text-sm">
                                        <thead
                                            class="text-slate-400 text-left text-xs uppercase bg-slate-100 font-semibold sticky top-0">
                                            <tr>
                                                <th class="p-3">SKU</th>
                                                <th class="p-3">Description</th>
                                                <th class="p-3 w-20">Qty</th>
                                                <th class="p-3 text-right">Unit Price</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-slate-100">
                                            <template x-for="item in poData.items" :key="item.id">
                                                <tr :class="item.alert ? 'bg-amber-50/50 hover:bg-amber-50' : 'hover:bg-white'"
                                                    class="transition-colors group">
                                                    <td class="p-2"><input type="text" x-model="item.sku"
                                                            class="w-full bg-transparent text-slate-700 font-mono focus:outline-none">
                                                    </td>
                                                    <td class="p-2 text-slate-500 text-xs"><input type="text"
                                                            x-model="item.description"
                                                            class="w-full bg-transparent focus:outline-none"></td>
                                                    <td class="p-2"><input type="number" x-model="item.qty"
                                                            class="w-full bg-transparent focus:outline-none"></td>
                                                    <td class="p-2 text-right">
                                                        <div class="relative">
                                                            <input type="number" step="0.01" x-model="item.price"
                                                                :class="item.alert ? 'text-red-600 font-bold' : 'text-slate-700'"
                                                                class="w-full bg-transparent text-right focus:outline-none">
                                                            <div x-show="item.alert"
                                                                class="absolute right-0 top-full mt-1 z-10 w-48 bg-white shadow-lg border border-red-100 rounded p-2 text-[10px] text-red-600 hidden group-focus-within:block">
                                                                Price Variance! Historical: $<span
                                                                    x-text="item.originalPrice"></span></div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Insight Box -->
                                <div x-show="poData.items.some(i => i.alert)"
                                    class="bg-blue-50 p-4 rounded-lg flex items-start space-x-3 mb-6 animate-pulse">
                                    <i data-lucide="info" class="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"></i>
                                    <p class="text-xs text-blue-700 leading-relaxed"><strong>AI Insight:</strong> SKU
                                        BZ-440 unit price ($45.00) differs from historical average ($41.50). <span
                                            class="underline cursor-pointer hover:text-blue-900">Click to adjust before
                                            SAP export.</span></p>
                                </div>
                                <!-- Action Buttons -->
                                <div class="mt-auto grid grid-cols-2 gap-4">
                                    <button @click="exportSap()"
                                        class="flex justify-center items-center space-x-2 py-3 border border-slate-300 rounded-lg text-slate-600 font-medium hover:bg-slate-50 transition-colors"><i
                                            data-lucide="download" class="w-4 h-4"></i><span>Download
                                            .xlsx</span></button>
                                    <button @click="pushToSap()"
                                        class="flex justify-center items-center space-x-2 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all hover:scale-[1.02] active:scale-95"><i
                                            data-lucide="cloud-upload" class="w-4 h-4"></i><span>Validate & Push to
                                            SAP</span></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: MAILBOX / AUTO-INGESTION -->
                <div x-show="currentView === 'mailbox'" x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translateY-4" x-transition:enter-end="opacity-100 translateY-0">
                    <div
                        class="bg-white rounded-xl border border-slate-200 shadow-xl overflow-hidden min-h-[600px] flex flex-col">
                        <div class="p-8 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                            <div>
                                <h1 class="text-2xl font-bold text-slate-800 flex items-center gap-3">
                                    <span class="bg-blue-100 p-2 rounded-lg text-blue-600"><i data-lucide="inbox"
                                            class="w-6 h-6"></i></span>
                                    <span>Simulated Mailbox Ingestion</span>
                                </h1>
                                <p class="text-slate-500 mt-2">The "No-Touch" Workflow: Watch AI scan, parse, and verify
                                    emails in real-time.</p>
                            </div>
                            <!-- Main Action -->
                            <button @click="startIngestion()" :disabled="ingestionState !== 'idle'"
                                class="bg-slate-900 text-white px-6 py-3 rounded-lg font-bold shadow-lg hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-all">
                                <i x-show="ingestionState === 'idle'" data-lucide="refresh-cw" class="w-5 h-5"></i>
                                <span x-show="ingestionState === 'idle'">Check for New Orders</span>
                                <span x-show="ingestionState !== 'idle'">Ingestion Active...</span>
                            </button>
                        </div>

                        <!-- Content Area -->
                        <div class="p-8 flex-1 bg-slate-50">
                            <!-- Empty State -->
                            <div x-show="ingestionState === 'idle'"
                                class="h-full flex flex-col items-center justify-center text-slate-400 space-y-4">
                                <i data-lucide="server" class="w-16 h-16 opacity-20"></i>
                                <p>Waiting for connection to <span
                                        class="font-mono bg-slate-200 px-2 py-1 rounded text-slate-600">orders@acme-distro.com</span>
                                </p>
                            </div>

                            <!-- Progress Section -->
                            <div x-show="ingestionState !== 'idle'" class="max-w-3xl mx-auto w-full space-y-8">
                                <!-- Status text -->
                                <div class="text-center space-y-2">
                                    <h3 class="text-xl font-medium text-slate-700" x-text="ingestionMessage"></h3>
                                    <div class="w-full bg-slate-200 rounded-full h-2.5 overflow-hidden">
                                        <div class="bg-blue-600 h-2.5 rounded-full transition-all duration-500 ease-out"
                                            :style="'width: ' + ingestionProgress + '%'"></div>
                                    </div>
                                </div>

                                <!-- File List QUEUE -->
                                <div class="bg-white rounded-lg border border-slate-200 shadow-sm divide-y divide-slate-100"
                                    x-show="ingestionFiles.length > 0">
                                    <template x-for="file in ingestionFiles" :key="file.id">
                                        <div
                                            class="p-4 flex items-center justify-between group hover:bg-slate-50 transition-colors">
                                            <div class="flex items-center space-x-4">
                                                <!-- Icon State -->
                                                <div
                                                    class="w-10 h-10 rounded-full flex items-center justify-center transition-all bg-slate-100 text-slate-400">
                                                    <template x-if="file.status === 'pending'"><i data-lucide="file"
                                                            class="w-5 h-5"></i></template>
                                                    <template x-if="file.status === 'processing'"><i
                                                            data-lucide="loader-2"
                                                            class="w-5 h-5 animate-spin text-blue-500"></i></template>
                                                    <template x-if="file.status === 'complete'"><i data-lucide="check"
                                                            class="w-5 h-5 text-green-600"></i></template>
                                                </div>
                                                <div>
                                                    <h4 class="font-bold text-slate-800" x-text="file.name"></h4>
                                                    <p class="text-xs text-slate-500 flex items-center gap-2">
                                                        <span x-text="file.from"></span> &bull; <span
                                                            x-text="file.size"></span>
                                                        <span x-show="file.type === 'image'"
                                                            class="text-[10px] bg-purple-100 text-purple-700 px-1.5 rounded font-bold uppercase tracking-wider">OCR-Image
                                                            Enhanced</span>
                                                    </p>
                                                </div>
                                            </div>

                                            <!-- Validated Badge -->
                                            <div x-show="file.status === 'complete'" x-transition
                                                class="flex items-center space-x-2">
                                                <span class="text-green-600 text-sm font-bold">Data Extracted - 98%
                                                    Conf.</span>
                                                <button
                                                    class="text-slate-400 hover:text-slate-600 bg-slate-100 p-1.5 rounded-md"><i
                                                        data-lucide="arrow-right" class="w-4 h-4"></i></button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <div x-show="ingestionState === 'complete'" class="text-center pt-8">
                                    <button @click="currentView = 'dashboard'"
                                        class="text-blue-600 hover:text-blue-800 font-medium underline">Go to Extraction
                                        Workspace &rarr;</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: SHIPPING HUB -->
                <div x-show="currentView === 'shipping'" x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100">
                    <div class="space-y-6">
                        <!-- Command Center Header -->
                        <div class="flex flex-col md:flex-row justify-between md:items-end gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-slate-800">Logistics Command Center</h2>
                                <p class="text-slate-500">Live fleet tracking and risk management.</p>
                            </div>

                            <!-- Search & Filter Bar -->
                            <div class="flex items-center space-x-3 w-full md:w-auto">
                                <div class="relative group w-full md:w-64">
                                    <i data-lucide="search"
                                        class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 group-focus-within:text-blue-500 transition-colors"></i>
                                    <input type="text" x-model="searchQuery" placeholder="Search PO or Carrier..."
                                        class="w-full bg-white border border-slate-200 pl-10 pr-4 py-2 rounded-lg text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all shadow-sm">
                                </div>
                                <div class="relative">
                                    <select x-model="statusFilter"
                                        class="appearance-none bg-white border border-slate-200 pl-4 pr-10 py-2 rounded-lg text-sm font-bold text-slate-600 focus:outline-none focus:border-blue-500 cursor-pointer shadow-sm hover:bg-slate-50 transition-colors">
                                        <option value="all">All Statuses</option>
                                        <option value="delayed">Delayed Only</option>
                                        <option value="in-transit">In Transit</option>
                                        <option value="delivered">Delivered</option>
                                    </select>
                                    <i data-lucide="filter"
                                        class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Main Table -->
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                            <table class="w-full mb-0">
                                <thead
                                    class="bg-slate-50 text-slate-500 text-xs uppercase text-left border-b border-slate-100">
                                    <tr>
                                        <th class="p-4">PO Number</th>
                                        <th class="p-4">Carrier Status</th>
                                        <th class="p-4">Current Hub</th>
                                        <th class="p-4">ETA</th>
                                        <th class="p-4 text-right">Action</th>
                                    </tr>
                                </thead>
                                <template x-for="order in filteredOrders" :key="order.id">
                                    <tbody
                                        class="group hover:bg-slate-50/80 transition-colors border-b border-slate-100">
                                        <tr class="cursor-pointer">
                                            <td class="p-4 font-bold text-slate-700">
                                                <div class="flex items-center gap-2">
                                                    <div
                                                        class="p-2 bg-slate-100 rounded-lg text-slate-400 group-hover:bg-white group-hover:text-blue-500 transition-colors shadow-sm">
                                                        <i data-lucide="package" class="w-4 h-4"></i>
                                                    </div>
                                                    <span x-text="order.id"></span>
                                                </div>
                                            </td>
                                            <td class="p-4">
                                                <div class="flex items-center gap-2">
                                                    <span :class="order.statusClass"
                                                        class="px-2.5 py-1 rounded-full text-xs font-bold shadow-sm"
                                                        x-text="order.statusLabel"></span>
                                                    <span class="text-xs text-slate-400 font-medium"
                                                        x-text="order.carrier"></span>
                                                </div>
                                            </td>
                                            <td class="p-4 text-slate-600">
                                                <div class="flex items-center gap-1.5">
                                                    <i data-lucide="map-pin" class="w-3.5 h-3.5 text-slate-400"></i>
                                                    <span x-text="order.location"></span>
                                                </div>
                                            </td>
                                            <td class="p-4">
                                                <div class="flex items-center gap-2">
                                                    <span class="font-mono font-medium text-slate-700"
                                                        x-text="order.eta"></span>
                                                    <template x-if="isLate(order)">
                                                        <span
                                                            class="text-[10px] bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold uppercase tracking-wide">Late</span>
                                                    </template>
                                                </div>
                                            </td>
                                            <td class="p-4 text-right">
                                                <button @click.stop="handleAction(order)"
                                                    class="text-xs font-bold text-slate-600 bg-white border border-slate-200 hover:border-blue-500 hover:text-blue-600 px-3 py-1.5 rounded-lg shadow-sm transition-all active:scale-95 flex items-center gap-2 ml-auto">
                                                    <span x-text="order.actionLabel"></span>
                                                    <i :data-lucide="order.actionIcon" class="w-3 h-3"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <!-- EXPANDED TIMELINE ROW (Only if Timeline is expanded) -->
                                        <tr x-show="order.timelineExpanded" x-collapse>
                                            <td colspan="5"
                                                class="p-0 bg-slate-50/50 border-b border-slate-200 shadow-inner">
                                                <div class="p-8">
                                                    <!-- Pizza Tracker -->
                                                    <div
                                                        class="flex items-center justify-between relative max-w-5xl mx-auto mb-8">
                                                        <div
                                                            class="absolute top-4 left-0 right-0 h-1 bg-slate-200 -z-0 rounded-full mx-8">
                                                        </div>
                                                        <template x-for="step in order.timeline">
                                                            <div
                                                                class="relative z-10 flex flex-col items-center w-32 filter drop-shadow-sm">
                                                                <div :class="step.completed ? (step.error ? 'bg-red-500 ring-4 ring-white' : 'bg-green-500 ring-4 ring-white') : 'bg-white border-2 border-slate-300'"
                                                                    class="w-8 h-8 rounded-full flex items-center justify-center transition-all">
                                                                    <template x-if="step.completed && !step.error"><i
                                                                            data-lucide="check"
                                                                            class="w-4 h-4 text-white"></i></template>
                                                                    <template x-if="step.error"><i data-lucide="x"
                                                                            class="w-4 h-4 text-white"></i></template>
                                                                    <template x-if="!step.completed">
                                                                        <div class="w-2 h-2 bg-slate-300 rounded-full">
                                                                        </div>
                                                                    </template>
                                                                </div>
                                                                <div class="text-center mt-3">
                                                                    <div class="text-xs font-bold uppercase tracking-wider"
                                                                        :class="step.error ? 'text-red-600' : 'text-slate-700'"
                                                                        x-text="step.status"></div>
                                                                    <div class="text-[10px] text-slate-500 font-mono mt-1"
                                                                        x-text="step.date"></div>
                                                                </div>
                                                            </div>
                                                        </template>
                                                    </div>
                                                    <!-- Fake Map -->
                                                    <div
                                                        class="bg-slate-200 rounded-xl h-64 w-full relative overflow-hidden group/map shadow-inner border border-slate-300">
                                                        <!-- Map Background image -->
                                                        <img src="https://placehold.co/1200x400/e2e8f0/94a3b8?text=Interactive+Fleet+Map+Placeholder"
                                                            class="w-full h-full object-cover opacity-60 mix-blend-multiply">
                                                        <!-- Pings -->
                                                        <div
                                                            class="absolute top-1/2 left-1/3 bg-blue-600 w-4 h-4 rounded-full border-2 border-white shadow-lg transform -translate-x-1/2 -translate-y-1/2 animate-ping">
                                                        </div>
                                                        <div
                                                            class="absolute top-1/2 left-1/3 bg-blue-600 w-4 h-4 rounded-full border-2 border-white shadow-lg transform -translate-x-1/2 -translate-y-1/2">
                                                            <div
                                                                class="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[10px] px-2 py-1 rounded whitespace-nowrap">
                                                                Current Location</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </template>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- VIEW: SAP EXPORTS -->
                <div x-show="currentView === 'sap'" x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translateY-4" x-transition:enter-end="opacity-100 translateY-0">
                    <div
                        class="bg-white rounded-xl border border-slate-200 shadow-xl overflow-hidden min-h-[600px] flex flex-col">
                        <div class="p-8 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                            <div>
                                <h1 class="text-2xl font-bold text-slate-800 flex items-center gap-3">
                                    <span class="bg-blue-100 p-2 rounded-lg text-blue-600"><i data-lucide="database"
                                            class="w-6 h-6"></i></span>
                                    <span>SAP Integration Hub</span>
                                </h1>
                                <p class="text-slate-500 mt-2">Final verification before pushing to ERP.</p>
                            </div>
                            <button @click="finalizeSapExport()" :disabled="sapExporting"
                                class="px-6 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 transition-all transform active:scale-95"
                                :class="sapExporting ? 'bg-slate-300 cursor-wait text-slate-500' : 'bg-green-600 hover:bg-green-700 text-white'">
                                <i x-show="!sapExporting" data-lucide="send" class="w-5 h-5"></i>
                                <i x-show="sapExporting" data-lucide="loader" class="w-5 h-5 animate-spin"></i>
                                <span
                                    x-text="sapExporting ? 'Transmitting...' : 'Finalize & Export to SAP Team'"></span>
                            </button>
                        </div>

                        <div class="p-0 overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-slate-100 text-slate-500 text-xs uppercase border-b border-slate-200">
                                    <tr>
                                        <th class="p-4 w-16 text-center">Valid</th>
                                        <th class="p-4">PO Number</th>
                                        <th class="p-4">Vendor</th>
                                        <th class="p-4">SKU</th>
                                        <th class="p-4 text-center">Qty</th>
                                        <th class="p-4 text-right">Unit Price</th>
                                        <th class="p-4 text-right">Total</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100 text-sm">
                                    <template x-for="row in sapData" :key="row.id">
                                        <tr class="hover:bg-slate-50 transition-colors group">
                                            <td class="p-4 text-center">
                                                <div class="flex justify-center">
                                                    <template x-if="row.status === 'ok'"><i data-lucide="check-circle"
                                                            class="w-5 h-5 text-green-500 fill-green-50"></i></template>
                                                    <template x-if="row.status === 'warning'">
                                                        <div class="relative group/tooltip cursor-help">
                                                            <i data-lucide="alert-triangle"
                                                                class="w-5 h-5 text-amber-500 fill-amber-50"></i>
                                                            <div
                                                                class="absolute left-1/2 -translate-x-1/2 bottom-full mb-2 bg-amber-800 text-white text-xs p-2 rounded shadow-lg whitespace-nowrap hidden group-hover/tooltip:block z-50">
                                                                <span x-text="row.msg"></span>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </td>
                                            <td class="p-4 font-mono font-medium text-slate-700" x-text="row.po"></td>
                                            <td class="p-4 text-slate-600" x-text="row.vendor"></td>
                                            <td class="p-4 font-mono text-slate-600" x-text="row.sku"></td>
                                            <td class="p-4 text-center font-medium" x-text="row.qty"></td>
                                            <td class="p-4 text-right font-mono" x-text="'$' + row.price.toFixed(2)">
                                            </td>
                                            <td class="p-4 text-right font-bold text-slate-800"
                                                x-text="'$' + (row.qty * row.price).toFixed(2)"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                        <div class="p-4 bg-slate-50 border-t border-slate-200 text-xs text-slate-400 text-right">
                            Showing 5 of 142 Pending records
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>
</body>

</html>